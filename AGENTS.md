# AI Agent Instructions (AGENTS.md)

このファイルは、このプロジェクト（18xxサマリーサイト）を編集・管理するAIエージェント向けの指示書です。作業を開始する前に必ずこの内容を確認し、遵守してください。

## プロジェクト概要

- **プロジェクト名**: 18xxサマリーサイト
- **目的**: 18xxボードゲームのルール要点を、スマートフォンで読みやすく、印刷も可能な形でWeb公開する
- **技術スタック**: MkDocs + Material for MkDocs（Pythonベースの静的サイトジェネレーター）
- **管理者**: 非エンジニアの個人

### 役割分担の原則

**ユーザー（プロジェクト管理者）の役割**:
- サマリーの原案作成（Markdown形式、内容はほぼ完成形で提供）
- 日本語の文章、表現、語尾の決定
- ルールの正確性の確保

**AIエージェントの役割**:
- Markdown記法の技術的検証（構文エラー、必須構造の確認）
- 構成の一貫性チェック（タブの使い分け、見出し階層、内容の配置）
- ファイルの配置と関連ファイルの更新
- テキストファイルの自動生成
- エラーや不整合の報告と修正方法の提案

**重要**: AIエージェントは内容の良し悪しやルールの正確性を判断せず、ユーザーが提供した原案の内容をそのまま使用する。技術的なエラーと構成の不整合のみを指摘する。

## ファイル構造と責務

- `docs/games/` - ゲームのMarkdownファイル（編集対象）
- `docs/assets/` - テキストDL用ファイル（`export_text.py`で自動生成、手動編集禁止）
- `docs/stylesheets/extra.css` - 印刷・モバイル表示用CSS（**変更禁止**）
- `scripts/export_text.py` - Markdownからテキストファイルを生成するスクリプト
- `mkdocs.yml` - サイト全体のナビゲーション設定（新規ゲーム追加時に更新必須）

## 必須作業手順

### 前提：役割分担
- **ユーザー**: サマリーの原案（Markdown形式）を作成・提供する
- **AIエージェント**: 原案の技術的検証、ファイル配置、関連ファイル更新を行う

### パターン1: 既存ゲームのサマリー更新

**ユーザーから受け取るもの**: 修正済みのMarkdown原案

**AIエージェントが実行すること**:
1. 原案のMarkdown記法を検証する（構文エラー、必須構造、構成の一貫性の確認）
2. 問題がなければ `docs/games/<ゲーム名>.md` に保存する
3. `python scripts/export_text.py` を実行して `docs/assets/<ゲーム名>.txt` を更新する
4. 更新した `.md` と `.txt` の両方をユーザーに提示する

**エラーや不整合があった場合**: 具体的なエラー箇所と修正方法をユーザーに説明し、修正後の原案の再提供を依頼する

### パターン2: 新規ゲームの追加

**ユーザーから受け取るもの**: 新しいゲームのMarkdown原案

**AIエージェントが実行すること**:
1. 原案のMarkdown記法を検証する（構文エラー、必須構造、構成の一貫性の確認）
2. 問題がなければ `docs/games/<新しいゲーム名>.md` に保存する
3. `docs/games/index.md` にリンクを追加する（アルファベット順または数字順）
4. `mkdocs.yml` の `nav` セクションに追加する
5. `python scripts/export_text.py` を実行して `.txt` ファイルを生成する
6. 作成・更新した全てのファイル（`.md`, `index.md`, `mkdocs.yml`, `.txt`）をユーザーに提示する

**エラーや不整合があった場合**: 具体的なエラー箇所と修正方法をユーザーに説明し、修正後の原案の再提供を依頼する

## AIエージェントの作業範囲

### ユーザーの役割
- サマリーの原案作成（内容はほぼ完成形で提供される）
- 日本語の文章、語尾、表現の決定

### AIエージェントの役割（技術的・機械的作業のみ）

#### 1. Markdown記法の検証
ユーザーが提供した原案について、以下の技術的なチェックを行う：

- **必須構造の確認**:
  - `# <ゲーム名> サマリー` のタイトルがあるか
  - `<div class="actions">` ブロックが存在するか
  - テキストDLリンクのパスが `../../assets/<ゲーム名>.txt` になっているか
  - タブ構造（`=== "SR"`, `=== "OR"`, `=== "セットアップ / 早見"`）が正しく記述されているか

- **Markdown構文のチェック**:
  - HTMLタグが正しく閉じられているか
  - テーブル記法が正しいか（`|` の数、ヘッダー行の `---` など）
  - リストのインデントが正しいか
  - 閉じていないコードブロック（` ``` `）がないか

- **構成の一貫性チェック**:
  - タブの分け方が既存ファイルと一貫しているか（SR/OR/セットアップ）
  - 見出しの階層が適切か（`##` と `###` の使い分け）
  - 内容が適切なタブに配置されているか（例：株式ラウンドのルールがSRタブにあるか）
  - プライベート一覧、列車一覧などが「セットアップ / 早見」タブにあるか

- **リンクとパスの検証**:
  - 相対パスが正しいか
  - 参照しているファイルが存在するか（または生成されるか）

#### 2. 関連ファイルの更新

新規ゲーム追加時、以下のファイルを機械的に更新する：

**`docs/games/index.md` の更新**:
```markdown
- [<新しいゲーム名>](<新しいゲーム名>.md)
```
を適切な位置（アルファベット順または数字順）に追加

**`mkdocs.yml` の更新**:
```yaml
- "<新しいゲーム名>": games/<新しいゲーム名>.md
```
を `nav` セクションの適切な位置に追加

#### 3. テキストファイルの生成

必ず `python scripts/export_text.py` を実行して `.txt` ファイルを生成・更新する

### 作業実行チェックリスト

ユーザーから原案を受け取ったら、以下を順に実行する：

1. [ ] 原案のMarkdown構文エラーを検証
2. [ ] 必須構造（actionsブロック、タブ構造）の存在を確認
3. [ ] 構成の一貫性を確認（タブの使い分け、見出し階層、内容の配置）
4. [ ] パスやリンクの正確性を確認
5. [ ] エラーや不整合があれば具体的な箇所と修正方法をユーザーに説明し、修正を依頼
6. [ ] 問題がなければファイルを適切な場所に配置
7. [ ] 新規ゲームの場合、`index.md` と `mkdocs.yml` を更新
8. [ ] `python scripts/export_text.py` を実行して `.txt` ファイルを生成
9. [ ] 実行した作業内容を説明し、更新した全てのファイルをユーザーに提示

**繰り返し**: 日本語の表現、語尾、ルールの内容の正確性についてはチェックも修正もしない。構成（タブ分け、見出し階層）の不整合は指摘するが、最終判断はユーザーに委ねる。

## エラー処理

### Markdown構文エラーを検出した場合

**AIエージェントが行うこと**:
1. エラーの具体的な箇所を特定（行番号、該当箇所）
2. エラーの種類を説明（閉じていないHTMLタグ、テーブル記法の誤りなど）
3. 修正方法を具体的に提案
4. ユーザーに修正後の原案の再提供を依頼

**報告例1（構文エラー）**:
```
Markdown構文エラーを検出しました：

【エラー箇所】
52行目: <div class="actions">
...
（閉じタグ </div> が見つかりません）

【修正方法】
actionsブロックの最後に </div> を追加してください。

修正後、原案を再度提供していただければ、ファイル配置作業を進めます。
```

**報告例2（構成の不整合）**:
```
構成の不整合を検出しました：

【問題箇所】
ORタブ内に「株式ラウンド」の見出しがあります（45行目）

【既存ファイルとの比較】
既存のゲームファイルでは、株式ラウンドの内容は「SR」タブに配置されています。

【提案】
この内容を「SR」タブに移動することをご検討ください。

もしこのゲーム特有の理由でこの配置が正しい場合は、そのままで問題ありません。
ご確認後、このまま進めるか、修正するかをお知らせください。
```

### `export_text.py` 実行時のエラー

エラーが発生した場合：

1. エラーメッセージを確認
2. 考えられる原因を平易な言葉で説明
3. 確認すべき項目を提示：
   - Python仮想環境が有効か（`which python` で確認）
   - 必要なパッケージがインストールされているか
   - Markdownファイルに特殊文字や不正な記述がないか
4. ユーザーに状況確認を依頼

### 予期しない問題が発生した場合

1. 何が起きたかを明確に説明
2. 影響範囲を特定
3. 可能であれば原因を推測
4. ユーザーに確認・判断を求める

## 作業実行時の注意事項

### AIエージェントが行うこと

1. **技術的検証**:
   - Markdown構文エラーの検出
   - 必須構造の存在確認
   - パスとリンクの正確性確認
   - **構成の一貫性確認**（タブの使い分け、見出し階層、内容の配置）

2. **機械的作業**:
   - ファイルの配置
   - index.mdとmkdocs.ymlの更新
   - export_text.pyの実行

3. **結果の報告**:
   - 実行した作業内容の説明
   - 生成・更新されたファイルの提示
   - エラーや不整合があった場合の具体的な説明

### AIエージェントが行わないこと

**内容の判断・修正**:
- 日本語の文章の良し悪し
- 語尾の統一（です・ます調など）
- 表現の選択
- ルールの正確性
- ゲームの内容に関する判断

**原則**: ユーザーが提供した原案の**内容**はそのまま使用する。技術的なエラーと構成の不整合のみを指摘し、修正はユーザーに依頼する。

## AIエージェントとしての行動原則

1. **技術的検証と構成チェックに徹する**: 
   - Markdown構文、必須構造、パスの正確性をチェック
   - タブの分け方、見出し階層、内容の配置が既存ファイルと一貫しているかチェック
   - 日本語の内容、表現、ルールの正確性には関与しない

2. **明確なエラー報告**: 
   - エラーや不整合があった場合は、具体的な箇所と理由を説明
   - 修正方法を提案し、ユーザーに原案の修正を依頼
   - 構成の不整合については、ゲーム特有の理由がある可能性も考慮して柔軟に対応
   - 技術用語は平易な言葉で補足説明

3. **完全な作業実行**: 
   - Markdown更新時は必ず `export_text.py` を実行
   - 新規ゲーム追加時は `index.md` と `mkdocs.yml` も更新
   - 関連する全てのファイルを漏れなく処理

4. **結果の提示**: 
   - 実行した作業内容を簡潔に説明
   - 生成・更新された全てのファイルをユーザーに提示
   - 次のステップ（ローカルプレビューなど）を案内

5. **原案の尊重**: 
   - ユーザーが提供した原案の**内容**を変更しない
   - 「改善案」や「提案」は技術的エラーと構成の不整合のみ
   - フォーマットや構造は既存ファイルに倣う

## 制約事項

### 変更禁止ファイル

以下のファイルは**絶対に変更しない**こと：

- `docs/stylesheets/extra.css` - 印刷・モバイル表示レイアウトが破壊される
- `.github/workflows/` 配下のファイル - 自動デプロイが動作しなくなる
- `requirements.txt` の既存パッケージ削除 - 依存関係が壊れる

### 慎重に扱うべきファイル

以下のファイルの変更は慎重に行い、必ずユーザーに確認を求める：

- `mkdocs.yml` - サイト構造の定義（新規ゲーム追加時の `nav` セクション更新は除く）
- `scripts/export_text.py` - テキスト生成ロジック

### その他の制約

- `docs/assets/` 配下のファイルは手動で編集しない（`export_text.py` で自動生成）
- Markdownファイルの構造（actionsブロック、タブ構造）は既存のフォーマットに従う
- サイト全体のデザイン変更は提案のみに留め、実装前に必ず確認を得る
